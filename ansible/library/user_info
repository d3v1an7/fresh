#!/bin/bash

USER_NAME="${USER}"

## Credit: http://stackoverflow.com/a/11704652
USER_NAME_FULL=$(osascript -e "long user name of (system info)")

## Credit: http://stackoverflow.com/a/19878198
USER_EMAIL=$(dscl . -read /Users/$(whoami) | grep '<string>.*@' | sed -e 's/<[^>]*>//g' | xargs)

if [ -z "${USER_NAME}" ]; then
  USER_NAME="null"
fi

if [ -z "${USER_NAME_FULL}" ]; then
  USER_NAME_FULL="null"
fi

if [ -z "${USER_EMAIL}" ]; then
  USER_EMAIL="null"
fi

## Ansible doesn't like new lines in the json, so make sure to strip those out with tr
cat | tr '\n' ' ' << EOF
{
  "changed": "true",
  "ansible_facts": {
    "user_name": "${USER_NAME}",
    "user_name_full": "${USER_NAME_FULL}",
    "user_email": "${USER_EMAIL}"
  }
}
EOF
