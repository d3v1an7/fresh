---
- name: check if atom theme exists
  stat:
    path: "{{ home }}/.atom/packages/base16-eighties-one-dark"
  register: atom_theme

# Using `get_url` and `shell` unzip for now, as there seems to be issues with `unarchive` on 2.1.1.0
- name: download atom theme
  get_url:
    url: https://github.com/robneu/base16-eighties-one-dark/archive/master.zip
    dest: /tmp/base16-eighties-one-dark-master.zip
  when: atom_theme.stat.exists == false

- name: unzip atom theme
  shell: unzip -o /tmp/base16-eighties-one-dark-master.zip -d /tmp
  args:
    creates: /tmp/base16-eighties-one-dark-master
  when: atom_theme.stat.exists == false

- name: ensure atom preference dir exists
  file:
    path: "{{ home }}/.atom/packages/"
    recurse: yes
    state: directory

- name: copy theme to atom
  become: yes
  synchronize:
    src: /tmp/base16-eighties-one-dark-master/
    dest: "{{ home }}/.atom/packages/base16-eighties-one-dark/"
  when: atom_theme.stat.exists == false

- name: overwite atom config
  copy:
    content: |
      "*":
        welcome:
          showOnStartup: false
        editor:
          invisibles: {}
          fontFamily: "Source Code Pro"
          fontSize: 13
          showInvisibles: true
          showIndentGuide: true
          tabType: "soft"
        core:
          themes: [
            "one-dark-ui"
            "base16-eighties-one-dark"
          ]
    dest: "~/.atom/config.cson"
