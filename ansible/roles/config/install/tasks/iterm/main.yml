---
- name: check if iterm settings exists
  stat:
    path: "{{ home }}/Library/Preferences/com.googlecode.iTerm2.plist"
  register: iterm_settings

- name: check if style.json exists
  stat:
    path: "{{ home }}/Library/Application Support/iTerm2/DynamicProfiles/style.json"
  register: iterm_style

- name: open iterm to init preference files
  shell: open -a iTerm && sleep 2 && killall iTerm2
  when: iterm_settings.stat.exists == false

- name: copy style.json to dynamic profile folder
  copy:
    src: iterm/files/style.json
    dest: "{{ home }}/Library/Application Support/iTerm2/DynamicProfiles/style.json"
  when: iterm_style.stat.exists == false

- name: write iterm defaults
  osx_defaults:
    domain: com.googlecode.iterm2
    key: "{{ item.key }}"
    type: "{{ item.type }}"
    value: "{{ item.value }}"
  with_items:
    # Don’t display the annoying prompt when quitting iTerm
    - { key: "PromptOnQuit", type: "bool", value: "false" }
    # Don’t display the annoying update prompt
    - { key: "SUEnableAutomaticChecks", type: "bool", value: "false" }
    # Set default profile (GUID found in iterm/files/style.json)
    - { key: "Default Bookmark Guid", type: "string", value: "ba19744f-6af3-434d-aaa6-0a48e0969958" }

# - name: install shell integration
#   shell: curl -L https://iterm2.com/misc/install_shell_integration.sh | bash
